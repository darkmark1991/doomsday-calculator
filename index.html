<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">

    <title>Doomsday Date Calculator</title>
  </head>
  <body>
    <main class="container p-5">

        <div class="jumbotron">
            <h2>Doomsday Rule Calculator</h2>
            <div class="input-group my-3">
                <input type="text" class="form-control" id="date" placeholder="Enter date (Ex.: 1991-04-23)" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" title="Date format: YYYY-MM-DD">
                <div class="input-group-append">
                    <button class="btn btn-primary" onclick="calcDoomsday()">Submit</button>
                </div>
            </div>

            <div class="mt-3">
                <p id="centuryDoomsday"></p>
                <p id="calculateYear"></p>
                <p id="yearDoomsday"></p>
                <p id="closestDoomsday"></p>
                <p id="dayOfTheWeek"></p>
                <p class="font-weight-bold" id="conclusion"></p>
                <p class="font-weight-bold text-danger" id="error"></p>
            </div>
        </div>
    </main>

    <script>
        const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const anchorDoomsdays = [2, 0, 5, 3];
        // The first values are zeroed out to make month number correspond to index
        const monthDoomsdays = [NaN, 3, 28, 0, 4, 9, 6, 11, 8, 5, 10, 7, 12]
        const months = ['N/A', 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        const calcClosestDoomsday = (month, day, isLeapYear) => {
            console.log(month)
            let doomsMonth =
                (monthDoomsdays[month] + 30 + monthDoomsdays[month+1]) / 2 < day ? month : month + 1;
            let doomsDay = monthDoomsdays[doomsMonth]
            if (isLeapYear && (doomsMonth === 1 || doomsMonth === 2)) doomsDay++;
            return { month: doomsMonth, day: doomsDay };
        }

        const calcDoomsday = () => {
            const date = document.getElementById('date').value;
            // chack if Date.parse returned NaN
            if (Date.parse(date) !== Date.parse(date)) {
                document.getElementById('error').innerHTML =
                    'Please enter a valid date';
                document.getElementById('centuryDoomsday').innerHTML = '';
                document.getElementById('calculateYear').innerHTML = '';
                document.getElementById('yearDoomsday').innerHTML = '';
                document.getElementById('closestDoomsday').innerHTML = '';
                document.getElementById('dayOfTheWeek').innerHTML = '';
                document.getElementById('conclusion').innerHTML = '';
                return;
            } else {
                document.getElementById('error').innerHTML = '';
            }
            let [year, month, day] = date.split('-');
            month = month * 1;
            const yy = year % 100;
            const century = ~~(year / 100);
            const centuryDoomsday = century % 4;

            document.getElementById('centuryDoomsday').innerHTML =
                `The anchor doomsday for ${century}th century is ${daysOfWeek[centuryDoomsday]}`;
            
            const tmpA = ~~(yy / 12);
            const tmpB = yy % 12;
            const tmpC = ~~(tmpB / 4);
            const tmpD = (tmpA + tmpB + tmpC) % 7;
            const yearDoomsday = (centuryDoomsday + tmpD) % 7;

            document.getElementById('calculateYear').innerHTML =
                `${yy} / 12 = ${tmpA} + ${tmpB} <br>
                ${tmpB} / 4 = ${tmpC} + remainder <br>
                (${tmpA} + ${tmpB} + ${tmpC}) modulo 7 = ${tmpD} <br>`;

            document.getElementById('yearDoomsday').innerHTML =
                `The year doomsday for ${year} is ${tmpD} days from century doomsday,
                so it is: ${daysOfWeek[yearDoomsday]}`;

            const isLeapYear = year % 4 == 0;

            const closestDoomsday = calcClosestDoomsday(month, day, isLeapYear);
            console.log(closestDoomsday)

            document.getElementById('closestDoomsday').innerHTML =
                `${months[month]} ${day} is closest to doomsday date ${months[closestDoomsday.month]} ${closestDoomsday.day}`;

            const dayOfTheWeek = (yearDoomsday + (day - closestDoomsday.day) % 7) % 7;
            console.log(dayOfTheWeek)
            document.getElementById('dayOfTheWeek').innerHTML =
                `So it is ${day - closestDoomsday.day} days away from the nearest doomsday,
                which makes it ${daysOfWeek[dayOfTheWeek]}`;

            document.getElementById('conclusion').innerHTML =
                `${months[month]} ${day}, ${year} was a ${daysOfWeek[dayOfTheWeek]}`;
        }
    </script>
  </body>
</html>